<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GiggLinuX — Kernel Console</title>
  <style>
    :root {
      --bg: #000;
      --white: #eaeaea;
      --gray: #9aa3a1;
      --green: #7bd389;
      --muted-green: #3f7f63;
      --panel-bg: rgba(0,0,0,0.55);
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--white);font-family:"Ubuntu Mono",monospace;}
    body{display:flex;flex-direction:column;gap:12px;padding:12px;box-sizing:border-box;}
    .statusbar{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:#080808;border:1px solid rgba(255,255,255,0.04);}
    .status-left{color:var(--green);font-weight:700;}
    .status-right{color:var(--gray);display:flex;gap:12px;font-size:14px;}
    .tabs{display:flex;gap:8px;padding:6px 12px;background:#070707;border-top:1px solid rgba(255,255,255,0.02);}
    .tab{color:var(--green);padding:6px 10px;border:1px solid rgba(255,255,255,0.04);text-decoration:none;text-transform:uppercase;font-size:13px;}
    .searchbar{display:flex;align-items:center;gap:8px;padding:8px 12px;background:#050505;border:1px dashed rgba(255,255,255,0.02);}
    .prompt{color:var(--muted-green);margin-right:6px;}
    .console{flex:1 1 auto;background:linear-gradient(#000,#050505);padding:16px;border:1px solid rgba(255,255,255,0.04);font-size:13px;line-height:1.45;white-space:pre-wrap;overflow:auto;min-height:420px;color:var(--white);}
    .ok{color:var(--white);}        /* Log-Ausgaben in Weiß */
    .warn{color:var(--muted-green);}
    .err{color:#ff6b6b;}
    .dim{color:var(--gray);}
    @media(min-width:1000px){
      body{padding:20px 80px;}
    }
  </style>
</head>
<body>

  <div class="statusbar">
    <div class="status-left">Willkommen auf meiner Website</div>
    <div class="status-right">
      <div id="date" class="dim"></div>
      <div id="clock" class="dim"></div>
    </div>
  </div>

  <div class="tabs">
    <a class="tab" href="index.html">Home</a>
    <a class="tab" href="ueber-mich.html">Über mich</a>
    <a class="tab" href="projekte.html">Projekte</a>
    <a class="tab" href="kontakt.html">Kontakt</a>
  </div>

  <div class="searchbar">
    <div class="prompt">chuck@norris:~#</div>
    <form action="https://www.google.com/search" method="get" style="display:flex;gap:8px;align-items:center;">
      <input type="text" name="q" placeholder="DROP TABLES;" style="background:#000;color:var(--white);border:1px solid rgba(255,255,255,0.05);padding:6px 8px;font-family:inherit;font-size:14px;">
      <button type="submit" style="background:#0a0a0a;color:var(--green);border:1px solid rgba(255,255,255,0.05);padding:6px 10px;cursor:pointer;">run</button>
    </form>
  </div>

  <!-- Nur die Konsole bleibt -->
  <div class="console" id="console" aria-live="polite" aria-atomic="false"></div>

<script>
  // Datum / Uhrzeit
  function updateClock() {
    const now = new Date();
    document.getElementById('clock').textContent = `[${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}]`;
  }
  function updateDate() {
    const now = new Date();
    document.getElementById('date').textContent = now.toLocaleDateString('de-DE');
  }
  setInterval(updateClock,1000);
  updateClock(); updateDate();

  // Console helpers
  const consoleEl = document.getElementById('console');
  const bootStart = performance.now();
  function ts() {
    const ms = (performance.now() - bootStart) / 1000;
    return `[ ${ms.toFixed(6).padStart(10,' ')}]`;
  }
  function clog(line, cls='ok') {
    // escape basic HTML to be safe
    const esc = String(line).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    const html = `${ts()} <span class="${cls}">${esc}</span>\n`;
    consoleEl.insertAdjacentHTML('beforeend', html);
    consoleEl.scrollTop = consoleEl.scrollHeight;
  }
  const sleep = ms => new Promise(r=>setTimeout(r,ms));

  // Robust IP/Geo loading with timeouts and fallback
  (async () => {
    clog('Booting Kernel: GiggLinuX (console-only)...', 'ok'); await sleep(350);
    clog('init: starting subsystems: coffee, humor, chaos ...', 'ok'); await sleep(400);
    clog("userland: executing whoami -> chucknorris", 'ok'); await sleep(500);
    clog('tasks: backe käsekuchen', 'ok'); await sleep(600);
    clog('tasks: putze klo', 'ok'); await sleep(600);
    clog('net: preparing interface eth0 ...', 'ok'); await sleep(700);

    // helper: promise timeout
    const withTimeout = (p, ms, label) => Promise.race([
      p,
      new Promise((_, rej) => setTimeout(() => rej(new Error(label + ' timeout')), ms))
    ]);

    try {
      // Try ipify for IP
      let ip;
      try {
        const r = await withTimeout(fetch('https://api.ipify.org?format=json', {cache:'no-store'}), 7000, 'ipify');
        if (!r.ok) throw new Error('ipify HTTP ' + r.status);
        const j = await r.json();
        ip = j.ip;
        clog(`net: assigned address ${ip}`, 'ok');
      } catch (e1) {
        clog('net: ipify failed or blocked -> trying ipapi directly', 'warn');
        // fallback to ipapi which returns ip + geo
        const r2 = await withTimeout(fetch('https://ipapi.co/json/', {cache:'no-store'}), 8000, 'ipapi-fallback');
        if (!r2.ok) throw new Error('ipapi HTTP ' + r2.status);
        const j2 = await r2.json();
        ip = j2.ip;
        clog(`net: assigned address ${ip}`, 'ok');
        // log geo from fallback response
        const city = j2.city || '';
        const region = j2.region || '';
        const country = j2.country_name || j2.country || '';
        const postal = j2.postal || '';
        const lat = j2.latitude ?? j2.lat ?? '';
        const lon = j2.longitude ?? j2.lon ?? '';
        const parts = [];
        if (postal) parts.push(postal);
        if (city) parts.push(city);
        if (region && region !== city) parts.push(region);
        if (country) parts.push(country);
        const locText = parts.length ? parts.join(', ') : 'Nicht verfügbar';
        clog(`geo: resolved -> ${locText}`, 'ok'); await sleep(300);
        if (lat && lon) clog(`coords: ${lat}, ${lon}`, 'ok');
        clog('services: user-space ready.', 'ok');
        clog('security: remember to stay safe ;)', 'ok');
        return; // done via fallback
      }

      // If we have IP, query ipapi for geo about that IP
      try {
        const rgeo = await withTimeout(fetch(`https://ipapi.co/${encodeURIComponent(ip)}/json/`, {cache:'no-store'}), 8000, 'ipapi-geo');
        if (!rgeo.ok) throw new Error('ipapi-geo HTTP ' + rgeo.status);
        const g = await rgeo.json();
        const city = g.city || '';
        const region = g.region || '';
        const country = g.country_name || g.country || '';
        const postal = g.postal || '';
        const lat = g.latitude ?? g.lat ?? '';
        const lon = g.longitude ?? g.lon ?? '';
        const parts = [];
        if (postal) parts.push(postal);
        if (city) parts.push(city);
        if (region && region !== city) parts.push(region);
        if (country) parts.push(country);
        const locText = parts.length ? parts.join(', ') : 'Nicht verfügbar';
        clog(`geo: resolved -> ${locText}`, 'ok'); await sleep(300);
        if (lat && lon) clog(`coords: ${lat}, ${lon}`, 'ok');
        clog('services: user-space ready.', 'ok'); await sleep(200);
        clog('security: remember to stay safe ;)', 'ok');
      } catch (eGeo) {
        clog('geo: failed to resolve location (ipapi)', 'warn');
        clog('services: user-space ready (partial).', 'ok');
      }
    } catch (e) {
      clog('net: failed to obtain IP/location (offline)', 'err');
      console.error(e);
    }
  })();
</script>

<!-- Hinweise falls Geo weiterhin nicht funktioniert -->
<!--
Debug-Tipps:
1) Stelle sicher, dass die Seite über HTTPS erreichbar ist (https://). Manche APIs blockieren unsichere Seiten.
2) Prüfe, ob ein Adblocker oder Privacy-Plugin fetch-Aufrufe an api.ipify.org oder ipapi.co blockiert.
3) Öffne die Entwicklerkonsole (F12) → Network/Console, schau nach HTTP-Fehlern (403/0) oder Timeout-Meldungen.
4) Wenn du eine strikte Content-Security-Policy (CSP) verwendest, erlaube connect-src zu https://api.ipify.org und https://ipapi.co.
-->

</body>
</html>
